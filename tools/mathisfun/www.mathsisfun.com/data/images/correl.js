var w,h,ratio,i,s,el,g,div,dragQ,game,my={};function correlMain(){var version='0.62';w=500;h=420;s="";s+='<div style="position:relative; width:'+w+'px; border: none; margin:auto; display:block;">';s+='<div style="display: block; width:96%; padding:2%; text-align: center; background-color: #def; z-index: 20;">';var inps=[['Values','vals']];var inp=inps[0];s+='<textarea id="'+inp[1]+'" style="width:'+(w-26)+'px; height:100px; font: bold 16px Arial; padding:3px; z-index:2;" value="" onkeyup="go(-1)"  onchange ="go(-1)" ></textarea>';s+='<div style="display: block; margin: 12px 0 16px 0;" >';var outps=[['Count','count',17],['Mean x','meanx',17],['Mean y','meany',17],['Correlation','correl',22]];for(var i=0;i<outps.length;i++){var outp=outps[i];s+='<div style="display: block; margin: 2px 30px 2px 0;" >';s+='<div style="display: inline-block; width: 120px; margin: 0 10px 0 0; font: 18px arial; color: black; text-align: right; ">'+outp[0]+': </div>';s+='<div id="'+outp[1]+'" style="display: inline-block; width: 147px; color: black; text-align:center; padding: 4px; background-color: #ffd; font: bold '+outp[2]+'px Arial; border: 2px solid lightblue; border-radius: 10px;"></div>';s+='</div>';}
s+='</div>';var groupCss='<div style="display: inline-block; font: 15px Arial; text-align:center; vertical-align: top; background-color: #efd; margin:3px; padding:2px; border-radius:5px; border: 2px inset yellow;" >';my.dispGraphQ=true;s+=groupCss;s+='<button id="dispGraphBtn" onclick="toggleDisp()" style="z-index:2;" class="togglebtn hi" >Graph</button>';s+='<button id="dispTableBtn" onclick="toggleDisp()" style="z-index:2;" class="togglebtn lo" >Table</button>';s+='</div>';s+='<div style="display: inline-block; vertical-align: top; margin:3px; padding:2px; border-radius:5px; " >';s+='<button id="numsBtn" onclick="toggleNums()" style="z-index:2;" class="togglebtn lo" >Nums</button>';s+='<button style="color: #8888ff; font-size: 14px;" class="togglebtn" onclick="canvasPrint()" >Print</button>';s+='<button style="color: #8888ff; font-size: 14px;" class="togglebtn" onclick="canvasSave()" >Save</button>';s+='</div>';s+='</div>';s+='<div id="tbl">';s+='</div>';s+='<canvas id="can" width="'+w+'" height="'+h+'" style="z-index:1;"></canvas>';s+='<div id="copyrt" style="font: 10px Arial; color: #6600cc;  text-align:center;">&copy; 2018 MathsIsFun.com  v'+version+'</div>';s+='</div>';document.write(s);el=document.getElementById('can');ratio=2;el.width=w*ratio;el.height=h*ratio;el.style.width=w+"px";el.style.height=h+"px";g=el.getContext("2d");g.setTransform(ratio,0,0,ratio,0,0);el.addEventListener('touchmove',ontouchmove,false);el.addEventListener('mousemove',onmousemove,false);this.vals=[[14.2,215],[16.4,325],[11.9,185],[15.2,332],[18.5,406],[22.1,522],[19.4,412],[25.1,614],[23.4,544],[18.1,421],[22.6,445],[17.2,408]];document.getElementById('vals').value=arr2str(this.vals);this.lt=70;this.tp=30;this.wd=420;this.ht=300;my.lblYMax=0;xstt=0;xend=6;ystt=0;yend=10;my.numsQ=false;my.clrs={expense:'#f44',income:'#88f',loan:'#f90',interest:'#c44',repay:'#0ff'}
my.periods=[];this.typ=0;console.log("go");go(0);}
function arr2str(arr){var s='';for(var i=0;i<arr.length;i++){if(i>0)s+=' ';s+='('+arr[i].join(',')+')';}
return s;}
function str2arr(s){var arr=[];var clean=s.trim();clean=clean.replace(/\)\(/gi,' ');clean=clean.replace(/[\(\)\[\]]/gi,'');console.log("str2arr",clean);var pairs=clean.split(/\s+/g);for(var i=0;i<pairs.length;i++){var vals=pairs[i].split(',');arr.push(vals);}
return arr;}
function toggleNums(){my.numsQ=!my.numsQ;toggleBtn("numsBtn",my.numsQ);go(-1);}
function toggleDisp(){my.dispGraphQ=!my.dispGraphQ;toggleBtn("dispGraphBtn",my.dispGraphQ);toggleBtn("dispTableBtn",!my.dispGraphQ);go(-1);}
function toggleTyp(){my.typNPVQ=!my.typNPVQ;toggleBtn("typNPVBtn",my.typNPVQ);toggleBtn("typLoanBtn",!my.typNPVQ);go(-1);}
function toggleBtn(btn,onq){if(onq){document.getElementById(btn).classList.add("hi");document.getElementById(btn).classList.remove("lo");}else{document.getElementById(btn).classList.add("lo");document.getElementById(btn).classList.remove("hi");}}
function go(n){this.vals=str2arr(document.getElementById('vals').value);console.log("this.vals",this.vals);correlUpdate();if(my.dispGraphQ){document.getElementById('tbl').innerHTML='';el.style.height=h+"px";var rect=rectGet(this.vals);my.coords=new Coords(60,20,w-60,300,rect.xstt,rect.ystt,rect.xend,rect.yend,false);g.clearRect(0,0,el.width,el.height);var graph=new Graph(g,my.coords);graph.drawGraph();ptsDraw(this.vals,my.coords);}else{el.style.height=0+"px";tblDraw(this.vals);}}
function rectGet(arr){var rect={};if(arr.length==0)return rect;var xmin=Number.MAX_VALUE;var xmax=0;var ymin=Number.MAX_VALUE;var ymax=0;for(var i=0;i<arr.length;i++){var x=arr[i][0];var y=arr[i][1];xmin=Math.min(xmin,x);xmax=Math.max(xmax,x);ymin=Math.min(ymin,y);ymax=Math.max(ymax,y);}
borderFactor=1.2;var xMid=(xmin+xmax)/2;var xhalfspan=borderFactor*(xmax-xmin)/2;rect.xstt=xMid-xhalfspan;rect.xend=xMid+xhalfspan;var yMid=(ymin+ymax)/2;var yhalfspan=borderFactor*(ymax-ymin)/2;rect.ystt=yMid-yhalfspan;rect.yend=yMid+yhalfspan;console.log("rectGet",rect);return rect;}
function correlUpdate(arr){var res=correlCalc(this.vals);document.getElementById('count').innerHTML=fmt2(res.count);document.getElementById('meanx').innerHTML=fmt2(res.mean.x);document.getElementById('meany').innerHTML=fmt2(res.mean.y);document.getElementById('correl').innerHTML=fmt5(res.correl);}
function correlCalc(arr){var xSum=0;var ySum=0;var x2Sum=0;var y2Sum=0;var xySum=0;var n=arr.length;for(var i=0;i<n;i++){var xy=arr[i];var x=Number(xy[0]);var y=Number(xy[1]);xSum+=x;ySum+=y;x2Sum+=x*x;y2Sum+=y*y;xySum+=x*y;}
var correl=(n*xySum-xSum*ySum)/(Math.sqrt(n*x2Sum-xSum*xSum)*Math.sqrt(n*y2Sum-ySum*ySum));console.log("calcCorrel",xSum,ySum,xSum/n,ySum/n,correl);return{correl:correl,count:n,mean:{x:xSum/n,y:ySum/n}};}
function ptsDraw(arr,coords){for(var i=0;i<arr.length;i++){var xy=arr[i];var x=Number(xy[0]);var y=Number(xy[1]);var xPix=coords.toXPix(x,false);var yPix=coords.toYPix(y,false);g.strokeStyle='blue';g.fillStyle='yellow';g.beginPath();g.arc(xPix,yPix,3,0,2*Math.PI);g.stroke();if(my.numsQ){s='('+xy.join(',')+')';g.fillStyle='black';g.font='12px Arial';g.beginPath();g.fillText(s,xPix,yPix-5)
g.fill();}}}
function onmousemove(e){}
function ontouchmove(evt){var touch=evt.targetTouches[0];evt.clientX=touch.clientX;evt.clientY=touch.clientY;evt.touchQ=true;onmousemove(evt);evt.preventDefault();}
function periodCalc(typ){my.periods=[];var curr=0;var fact=1;for(i=0;i<vals.length;i++){var stt=curr;var int=my.i*curr;var cash=0;if(vals[i]!=undefined){cash=Number(vals[i]);}
if(my.typNPVQ){var pv=cash*fact;curr+=pv;var fin=curr;curr=fin;fact/=(1+my.i);my.periods.push({cash:cash,pv:pv,stt:stt,incInt:stt,fin:fin});}else{curr+=int;var incInt=curr;curr+=cash;var fin=curr;curr=fin;my.periods.push({cash:cash,int:int,stt:stt,incInt:incInt,fin:fin});}}}
function tbl2vals(){var s='';for(var i=0;i<my.tbln;i++){var div=document.getElementById('t'+i+'x');if(i>0)s+=' ';s+='('+div.value;var div=document.getElementById('t'+i+'y');s+=',';s+=div.value+')';}
document.getElementById('vals').value=s;}
function tblDraw(arr){var s='';s+='<div>';s+=getDivStr(id,'','period');s+=getDivStr(id,'In/Out','x');s+=getDivStr(id,'PV','y');s+='</div>';for(var i=0;i<arr.length;i++){var xy=arr[i];var x=Number(xy[0]);var y=Number(xy[1]);var id='t'+i.toString();s+='<div>';s+=getDivStr(id,i+1,'period');s+=getDivStr(id+'x',x,'in');s+=getDivStr(id+'y',y,'in');s+='</div>';}
s+='<button style="color: #8888ff; font-size: 14px;" class="togglebtn" onclick="tblAdd()" >Add</button>';my.tbln=arr.length;var div=document.getElementById('tbl');div.innerHTML=s;}
function tblAdd(){this.vals.push([0,0]);tblDraw(this.vals);}
function tblValUpdate(id){tbl2vals();this.vals=str2arr(document.getElementById('vals').value);console.log("this.vals",this.vals);correlUpdate();}
function getDivStr(id,val,typ){var s='';switch(typ){case 'period':s+='<div style="display: inline-block; width:25px; font: bold 15px Arial; color:blue;  padding:3px; margin: 3px; text-align:center;  z-index:2;" value="'+val+'" />';s+=val;s+='</div>';break;case 'title':s+='<div style="display: inline-block; width:80px; font: bold 15px Arial; color:blue;  padding:3px; margin: 3px; text-align:center;  z-index:2;" value="'+val+'" />';s+=val;s+='</div>';break;case 'in':s+='<input id="'+id+'" style="width:80px; font: 15px Arial; color:blue;  padding:3px; margin: 3px; text-align:center;  z-index:2;" value="'+val+'" onkeyup="tblValUpdate(\''+id+'\')"  onchange ="tblValUpdate(\''+id+'\')" /> &nbsp;';break;case 'fix':s+='<div style="display: inline-block; width:80px; font: 15px Arial; color:blue;  padding:3px; margin: 3px; text-align:center;  z-index:2;" value="'+val+'" />';s+=fmt2(val);s+='</div>';break;default:}
return s;}
function fmt2(v){if(Math.round(v)==v){return v;}else{return parseFloat(Math.round(v*100)/100).toFixed(2);}}
function fmt5(v){if(Math.round(v)==v){return v;}else{return parseFloat(Math.round(v*100000)/100000).toFixed(5);}}
function drawBarLine(typ){g.font='18px Verdana';g.textAlign='center';g.fillStyle='black';g.fillText(this.title,this.lt+this.wd/2,this.tp-8);g.font='16px Verdana';g.fillStyle='blue';g.fillText(this.xtitl,this.lt+this.wd/2,my.lblYMax+20);g.fillStyle='darkorange';var txt=this.ytitl;var rot=-Math.PI/2;g.rotate(rot);g.fillText(txt,-ht/2-10,15);g.rotate(-rot);g.font='14px Verdana';g.textAlign='center';TotVal=0;if(my.pctsQ){for(i=0;i<vals.length;i++){if(vals[i]!=undefined){TotVal+=Number(vals[i]);}}
if(my.numsQ){PctHeight=25;}else{PctHeight=0;}}
xTick=1;clrnum=0;g.lineStyle='0000ff';g.lineWidth=1;prevPt=[];var xGap=this.wd/xspan;var zero=this.tp+this.ht+ystt/yscale;for(var i=0;i<my.periods.length;i++){var xp=this.lt+(i+1)*xGap;var period=my.periods[i];var stt=period.stt;var mid=period.incInt;var fin=period.fin;barwidth=0.8*this.wd/xspan;if(barwidth>50)barwidth=50;switch(typ){case "npv":g.strokeStyle='black';g.beginPath();if(stt>=fin){g.fillStyle=my.clrs.expense;}else{g.fillStyle=my.clrs.income;}
g.rect(xp,zero-stt/yscale,barwidth/2,(stt-fin)/yscale);g.stroke();g.fill();if(my.numsQ){var yText=-3;if(mid-fin>0)yText=12;g.fillStyle='black';g.beginPath();g.fillText(fmt2(fin),xp+barwidth/4,zero-fin/yscale+yText);g.fill();}
break;case "loan":g.strokeStyle='black';g.beginPath();g.fillStyle=my.clrs.interest;g.rect(xp-barwidth/2,zero-stt/yscale,barwidth/2,(stt-mid)/yscale);g.stroke();g.fill();g.beginPath();if(stt>=fin){g.fillStyle=my.clrs.loan;}else{g.fillStyle=my.clrs.repay;}
g.rect(xp,zero-mid/yscale,barwidth/2,(mid-fin)/yscale);g.stroke();g.fill();if(my.numsQ){var yText=-3;if(mid-fin>0)yText=17;g.fillStyle='black';g.beginPath();g.fillText(fmt2(fin),xp+barwidth/4,zero-fin/yscale+yText);g.fill();}
break;default:}}}
function getPlace(angle){var places=[[0,75,[0,0,"left"]],[75,105,[0,15,"center"]],[105,255,[0,0,"right"]],[255,285,[0,0,"center"]],[285,360,[]]];places[4][2]=places[0][2];var angled=angle*180/Math.PI;angled-=Math.round(angled/360-0.5)*360;for(var i=0;i<places.length;i++){if(angled>=places[i][0]&&angled<=places[i][1]){return(places[i][2]);}}
return(places[0][2]);}
function canvasSave(){var can=document.getElementById("can");var dataUrl=can.toDataURL('image/png');var win=window.open();win.document.write("<img src='"+dataUrl+"'/>");}
function canvasPrint(){var can=document.getElementById("can");var dataUrl=can.toDataURL('image/png');var win=window.open();win.document.write("<img src='"+dataUrl+"'/>");var isChrome=(window.navigator.userAgent.toLowerCase().indexOf("chrome")>-1);if(isChrome){win.focus();setTimeout(function(){win.print();},500);}else{win.focus();win.print();win.close();}}
function wrapText(context,text,x,y,maxWidth,lineHeight){var words=text.split(' ');var line='';for(var n=0;n<words.length;n++){var testLine=line+words[n]+' ';var metrics=context.measureText(testLine);var testWidth=metrics.width;if(testWidth>maxWidth&&n>0){context.fillText(line,x,y);line=words[n]+' ';y+=lineHeight;}else{line=testLine;}}
my.lblYMax=Math.max(my.lblYMax,y);context.fillText(line,x,y);}
function getPopHTML(){s='';s+='<style>input[type="radio"]:checked+label {font-weight: bold;}</style>';s+='<div id="editpop" style="position:absolute; left:-450px; top:40px; padding: 5px; border: 1px solid red; border-radius: 9px; background-color: #88aaff; box-shadow: 10px 10px 5px 0px rgba(40,40,40,0.75); z-index:1; transition: all linear 0.3s; opacity:0; font: 14px Arial;  ">';inps=[['Investment','popInv',1000],['Income','popInc',200],['Number of Periods','popn',10],['Interest Rate (%)','popInt',5]];for(var i=0;i<inps.length;i++){var inp=inps[i];s+='<div style="font: 14px Arial; text-align:right; width:300px; " >';s+='<span id="'+inp[1]+'Lbl" style="font: 15px Arial; padding:3px; margin: 3px; text-align:right;  z-index:2;">'+inp[0]+'</span>';s+='<input id="'+inp[1]+'" style="width:100px; font: 15px Arial; color:blue;  padding:3px; margin: 3px; text-align:center;  z-index:2;" value="'+inp[2]+'" onkeyup="go(-1)"  onchange ="go(-1)" /> &nbsp;';s+='</div>'}
s+='<div style="text-align:center;">';s+='<button onclick="editYes()" style="z-index:2; font: 22px Arial;" class="togglebtn" >&#x2714;</button>';s+='<button onclick="editNo()" style="z-index:2; font: 22px Arial;" class="togglebtn" >&#x2718;</button>';s+='</div>';s+='</div>';return s;}
function doPop(){console.log("doPop");if(my.typNPVQ){document.getElementById('popInvLbl').innerHTML='Investment';document.getElementById('popIncLbl').innerHTML='Income';}else{document.getElementById('popInvLbl').innerHTML='Loan Amount';document.getElementById('popIncLbl').innerHTML='Payment Amount';}
var pop=document.getElementById('editpop');pop.style.transitionDuration="0.3s";pop.style.opacity=1;pop.style.zIndex=12;pop.style.left='50px';}
function editYes(){var pop=document.getElementById('editpop');pop.style.opacity=0;pop.style.zIndex=1;pop.style.left='-500px';console.log("editYes",my.fn);my.i=Number(document.getElementById('popInt').value)/100;var inv=Number(document.getElementById('popInv').value);var inc=Number(document.getElementById('popInc').value);var n=Number(document.getElementById('popn').value);var s=(-inv).toString();for(var i=0;i<n;i++){s+=',';s+=inc;}
document.getElementById('vals').value=s;go(0);}
function editNo(){var pop=document.getElementById('editpop');pop.style.opacity=0;pop.style.zIndex=1;pop.style.left='-500px';}
function Coords(left,top,width,height,xStt,yStt,xEnd,yEnd,uniScaleQ){this.left=left;this.top=top;this.width=width;this.height=height;this.xStt=xStt;this.yStt=yStt;this.xEnd=xEnd;this.yEnd=yEnd;this.uniScaleQ=uniScaleQ;this.xLogQ=false;this.yLogQ=false;this.calcScale();}
Coords.prototype.calcScale=function(){if(this.xLogQ){if(this.xStt<=0)
this.xStt=1;if(this.xEnd<=0)
this.xEnd=1;}
if(this.yLogQ){if(this.yStt<=0)
this.yStt=1;if(this.yEnd<=0)
this.yEnd=1;}
var temp;if(this.xStt>this.xEnd){temp=this.xStt;this.xStt=this.xEnd;this.xEnd=temp;}
if(this.yStt>this.yEnd){temp=this.yStt;this.yStt=this.yEnd;this.yEnd=temp;}
var xSpan=this.xEnd-this.xStt;if(xSpan<=0)
xSpan=1e-9;this.xScale=xSpan/this.width;this.xLogScale=(Math.log(this.xEnd)-Math.log(this.xStt))/this.width;var ySpan=this.yEnd-this.yStt;if(ySpan<=0)
ySpan=1e-9;this.yScale=ySpan/this.height;this.yLogScale=(Math.log(this.yEnd)-Math.log(this.yStt))/this.height;if(this.uniScaleQ&&!this.xLogQ&&!this.yLogQ){var newScale=Math.max(this.xScale,this.yScale);this.xScale=newScale;xSpan=this.xScale*this.width;var xMid=(this.xStt+this.xEnd)/2;this.xStt=xMid-xSpan/2;this.xEnd=xMid+xSpan/2;this.yScale=newScale;ySpan=this.yScale*this.height;var yMid=(this.yStt+this.yEnd)/2;this.yStt=yMid-ySpan/2;this.yEnd=yMid+ySpan/2;}};Coords.prototype.scale=function(factor,xMid,yMid){if(typeof xMid=='undefined')xMid=(this.xStt+this.xEnd)/2;this.xStt=xMid-(xMid-this.xStt)*factor;this.xEnd=xMid+(this.xEnd-xMid)*factor;if(typeof yMid=='undefined')yMid=(this.yStt+this.yEnd)/2;this.yStt=yMid-(yMid-this.yStt)*factor;this.yEnd=yMid+(this.yEnd-yMid)*factor;this.calcScale();};Coords.prototype.drag=function(xPix,yPix){this.xStt+=xPix*this.xScale;this.xEnd+=xPix*this.xScale;this.yStt+=yPix*this.yScale;this.yEnd+=yPix*this.yScale;this.calcScale();};Coords.prototype.newCenter=function(x,y){var xMid=this.xStt+x*this.xScale;var xhalfspan=(this.xEnd-this.xStt)/2;this.xStt=xMid-xhalfspan;this.xEnd=xMid+xhalfspan;var yMid=this.yEnd-y*this.yScale;var yhalfspan=(this.yEnd-this.yStt)/2;this.yStt=yMid-yhalfspan;this.yEnd=yMid+yhalfspan;this.calcScale();};Coords.prototype.fitToPts=function(pts,borderFactor){for(var i=0;i<pts.length;i++){var pt=pts[i];if(i==0){this.xStt=pt.x;this.xEnd=pt.x;this.yStt=pt.y;this.yEnd=pt.y;}else{this.xStt=Math.min(this.xStt,pt.x);this.xEnd=Math.max(this.xEnd,pt.x);this.yStt=Math.min(this.yStt,pt.y);this.yEnd=Math.max(this.yEnd,pt.y);}}
var xMid=(this.xStt+this.xEnd)/2;var xhalfspan=borderFactor*(this.xEnd-this.xStt)/2;this.xStt=xMid-xhalfspan;this.xEnd=xMid+xhalfspan;var yMid=(this.yStt+this.yEnd)/2;var yhalfspan=borderFactor*(this.yEnd-this.yStt)/2;this.yStt=yMid-yhalfspan;this.yEnd=yMid+yhalfspan;this.calcScale();};Coords.prototype.toXPix=function(val,useCornerQ){if(this.xLogQ){return this.left+(Math.log(val)-Math.log(xStt))/this.xLogScale;}else{return this.left+((val-this.xStt)/this.xScale);}};Coords.prototype.toYPix=function(val){if(this.yLogQ){return this.top+(Math.log(yEnd)-Math.log(val))/this.yLogScale;}else{return this.top+((this.yEnd-val)/this.yScale);}};Coords.prototype.toPtVal=function(pt,useCornerQ){return new Pt(this.toXVal(pt.x,useCornerQ),this.toYVal(pt.y,useCornerQ));};Coords.prototype.toXVal=function(pix,useCornerQ){if(useCornerQ){return this.xStt+(pix-this.left)*this.xScale;}else{return this.xStt+pix*this.xScale;}};Coords.prototype.toYVal=function(pix,useCornerQ){if(useCornerQ){return this.yEnd-(pix-top)*this.yScale;}else{return this.yEnd-pix*this.yScale;}};Coords.prototype.getTicks=function(stt,span,ratio){var ticks=[];var inter=this.tickInterval(span/ratio,false);var tickStt=Math.ceil(stt/inter)*inter;var i=0;do{var tick=tickStt+i*inter;tick=Number(tick.toPrecision(8));ticks.push([tick,1]);i++;}while(tick<stt+span);inter=this.tickInterval(span/ratio,true);for(i=0;i<ticks.length;i++){var t=ticks[i][0];if(Math.abs(Math.round(t/inter)-(t/inter))<0.001){ticks[i][1]=0;}}
return ticks;};Coords.prototype.tickInterval=function(span,majorQ){var pow10=Math.pow(10,Math.floor(Math.log(span)*Math.LOG10E));var mantissa=span/pow10;if(mantissa>=5){if(majorQ){return(5*pow10);}else{return(1*pow10);}}
if(mantissa>=3){if(majorQ){return(2*pow10);}else{return(0.2*pow10);}}
if(mantissa>=1.4){if(majorQ){return(0.5*pow10);}else{return(0.2*pow10);}}
if(mantissa>=0.8){if(majorQ){return(0.5*pow10);}else{return(0.1*pow10);}}
if(majorQ){return(0.2*pow10);}else{return(0.1*pow10);}};function Graph(g,coords){this.g=g;this.coords=coords;this.xLinesQ=true;this.yLinesQ=true;this.xValsQ=true;this.yValsQ=true;this.skewQ=false;}
Graph.prototype.makeSVG=function(){this.hzAxisY=coords.toYPix(0);if(this.hzAxisY<0)this.hzAxisY=0;if(this.hzAxisY>coords.height)this.hzAxisY=coords.height;this.hzNumsY=this.hzAxisY+14;if(this.hzAxisY>coords.height-10)this.hzNumsY=coords.height-3;this.vtAxisX=coords.toXPix(0);if(this.vtAxisX<0)this.vtAxisX=0;if(this.vtAxisX>coords.width)this.vtAxisX=coords.width;this.vtNumsX=this.vtAxisX-5;if(this.vtAxisX<10)this.vtNumsX=20;my.svg.moveTo(coords.toXPix(coords.xStt,false),this.hzAxisY);my.svg.lineTo(coords.toXPix(coords.xEnd,false),this.hzAxisY);my.svg.moveTo(this.vtAxisX,coords.toYPix(coords.yStt,false));my.svg.lineTo(this.vtAxisX,coords.toYPix(coords.yEnd,false));}
Graph.prototype.drawGraph=function(){var coords=this.coords;this.hzAxisY=coords.toYPix(0);if(this.hzAxisY<coords.top)this.hzAxisY=coords.top;if(this.hzAxisY>coords.top+coords.height)this.hzAxisY=coords.top+coords.height;this.hzNumsY=this.hzAxisY+14;if(this.hzAxisY>coords.top+coords.height-10)this.hzNumsY=coords.top+coords.height-3;this.vtAxisX=coords.toXPix(0);if(this.vtAxisX<coords.left)this.vtAxisX=coords.left;if(this.vtAxisX>coords.left+coords.width)this.vtAxisX=coords.left+coords.width;this.vtNumsX=this.vtAxisX-5;this.vtNumsAlign='right';if(this.vtAxisX<30){this.vtNumsX=this.vtAxisX+4;this.vtNumsAlign='left';if(this.vtAxisX<0){this.vtNumsX=6;}}
if(coords.xLogQ){this.drawLinesLogX();}else{if(this.xLinesQ){this.drawHzLines();}}
if(coords.yLogQ){this.drawLinesLogY();}else{if(this.yLinesQ){this.drawVtLines();}}};Graph.prototype.drawVtLines=function(){var g=this.g;g.lineWidth=1;var coords=this.coords;var ticks=coords.getTicks(coords.xStt,coords.xEnd-coords.xStt,coords.width/100);for(var i=0;i<ticks.length;i++){var tick=ticks[i];var xVal=tick[0];var tickLevel=tick[1];if(tickLevel==0){g.strokeStyle="rgba(0,0,256,0.3)";}else{g.strokeStyle="rgba(0,0,256,0.1)";}
var xPix=coords.toXPix(xVal,false);g.beginPath();g.moveTo(xPix,coords.toYPix(coords.yStt,false));g.lineTo(xPix,coords.toYPix(coords.yEnd,false));g.stroke();if(tickLevel==0&&this.xValsQ){g.fillStyle="#0000ff";g.font="bold 12px Verdana";g.textAlign="center";g.fillText(xVal.toString(),xPix,this.hzNumsY);}}
if(this.skewQ)
return;g.lineWidth=1.5;g.strokeStyle="#ff0000";g.beginPath();g.moveTo(this.vtAxisX,coords.toYPix(coords.yStt,false));g.lineTo(this.vtAxisX,coords.toYPix(coords.yEnd,false));g.stroke();g.beginPath();g.fillStyle=g.strokeStyle;g.drawArrow(this.vtAxisX,coords.toYPix(coords.yEnd),15,2,20,10,Math.PI/2,10,false);g.stroke();g.fill();};Graph.prototype.drawHzLines=function(){var g=this.g;g.lineWidth=1;var coords=this.coords;var ticks=coords.getTicks(coords.yStt,coords.yEnd-coords.yStt,coords.height/100);for(var i=0;i<ticks.length;i++){var tick=ticks[i];var yVal=tick[0];var tickLevel=tick[1];if(tickLevel==0){g.strokeStyle="rgba(0,0,256,0.3)";}else{g.strokeStyle="rgba(0,0,256,0.1)";}
var yPix=coords.toYPix(yVal,false);g.beginPath();g.moveTo(coords.toXPix(coords.xStt,false),yPix);g.lineTo(coords.toXPix(coords.xEnd,false),yPix);g.stroke();if(tickLevel==0&&this.yValsQ){g.fillStyle="#ff0000";g.font="bold 12px Verdana";g.textAlign=this.vtNumsAlign;g.fillText(yVal.toString(),this.vtNumsX,yPix+5);}}
if(this.skewQ)
return;g.lineWidth=2;g.strokeStyle="#0000ff";g.beginPath();g.moveTo(coords.toXPix(coords.xStt,false),this.hzAxisY);g.lineTo(coords.toXPix(coords.xEnd,false),this.hzAxisY);g.stroke();g.beginPath();g.fillStyle=g.strokeStyle;g.drawArrow(coords.toXPix(coords.xEnd,false),this.hzAxisY,15,2,20,10,0,10,false);g.stroke();g.fill();};CanvasRenderingContext2D.prototype.drawArrow=function(x0,y0,totLen,shaftHt,headLen,headHt,angle,sweep,invertQ){var g=this;var pts=[[0,0],[-headLen,-headHt/2],[-headLen+sweep,-shaftHt/2],[-totLen,-shaftHt/2],[-totLen,shaftHt/2],[-headLen+sweep,shaftHt/2],[-headLen,headHt/2],[0,0]];if(invertQ){pts.push([0,-headHt/2],[-totLen,-headHt/2],[-totLen,headHt/2],[0,headHt/2]);}
for(var i=0;i<pts.length;i++){var cosa=Math.cos(-angle);var sina=Math.sin(-angle);var xPos=pts[i][0]*cosa+pts[i][1]*sina;var yPos=pts[i][0]*sina-pts[i][1]*cosa;if(i==0){g.moveTo(x0+xPos,y0+yPos);}else{g.lineTo(x0+xPos,y0+yPos);}}};